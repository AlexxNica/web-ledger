<!DOCTYPE html>
<html>
  <head>
    <title>Flex 1.0</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <link rel="stylesheet" href="spec.css">
    <script src='respec-w3c-common.js' async class='remove'></script>
    <script src='utils.js' async class='remove'></script>
    <script type="text/javascript" class="remove">
var respecConfig = {
  // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
  specStatus:           "CG-DRAFT",

  // the specification's short name, as in http://www.w3.org/TR/short-name/
  shortName:            "flex",

  // subtitle for the specification
  subtitle: "A flexible Linked Data ledger format for the Web",

  // if you wish the publication date to be other than today, set this
  // publishDate:  "2009-08-06",

  // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
  // and its maturity status
  // previousPublishDate:  "1977-03-15",
  // previousMaturity:  "WD",

  // if there a publicly available Editor's Draft, this is the link
  edDraftURI:           "https://web-payments.github.io/flex-ledger/",

  // if this is a LCWD, uncomment and set the end of its review period
  // lcEnd: "2009-08-05",

  // editors, add as many as you like
  // only "name" is required
  editors: [
      { name: "Manu Sporny", url: "https://manu.sporny.org/",
        company: "Digital Bazaar, Inc.", companyURL: "http://digitalbazaar.com/" },
      { name: "Dave Longley", url: "https://github.com/dlongley",
        company: "Digital Bazaar, Inc.", companyURL: "http://digitalbazaar.com/" }
  ],

  // authors, add as many as you like.
  // This is optional, uncomment if you have authors as well as editors.
  // only "name" is required. Same format as editors.

  authors: [
    { name: "Manu Sporny", url: "https://manu.sporny.org/",
      company: "Digital Bazaar, Inc.", companyURL: "http://digitalbazaar.com/" },
    { name: "Dave Longley", url: "https://github.com/dlongley",
      company: "Digital Bazaar, Inc.", companyURL: "http://digitalbazaar.com/" },
  ],

  // extend the bibliography entries
  //localBiblio: {},

  // name of the WG
  wg:           "W3C Web Payments Community Group",

  // URI of the public WG page
  wgURI:        "http://www.w3.org/community/webpayments/",

  // name (with the @w3c.org) of the public mailing to which comments are due
  wgPublicList: "public-webpayments",

  // URI of the patent status for this WG, for Rec-track documents
  // !!!! IMPORTANT !!!!
  // This is important for Rec-track documents, do not copy a patent URI from a random
  // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
  // Team Contact.
  wgPatentURI:  "",
  maxTocLevel: 4,
  preProcess: [ ] /*,
  alternateFormats: [ {uri: "diff-20111214.html", label: "diff to previous version"} ],
  */
};
    </script>
    <style>
.sequence-diagram {
  margin: auto;
}
    </style>
</head>

<body>
<section id="abstract">
  <p>
This document outlines a data model and syntax for expressing a
set of ordered events (aka ledger) in way that can be cryptographically
verified. This technology is useful when coordinating the recording
of events, such as financial transactions, transfer of property, or
time-stamped data that must be shared among coordinating parties. A
primary goal of this ledger format is flexibility, allowing the
pluggability of consensus algorithms, data structures for recording
history, and the type of data that can be stored in the ledger.
  </p>
</section>

<section id="sotd">

  <p>There are a number of ways that one may participate in the development of
    this specification:</p>

  <ul>
    <li>Ad-hoc technical discussion primarily occurs on the public community mailing list:
      <a href="http://lists.w3.org/Archives/Public/public-webpayments/">public-webpayments@w3.org</a></li>

    <li>Specification bugs and issues should be reported in the
      <a href="https://github.com/web-payments/web-ledger/issues">issue tracker</a>
      if you do not want to send an e-mail to the public-webpayments mailing
      list.</li>

    <li><a href="https://github.com/web-payments/web-ledger/tree/master/">Source code</a>
      for the specification can be found on Github.</li>

  </ul>
</section>

<section class="informative">
  <h1>Introduction</h1>

  <p>
TBD
  </p>
  <section class="informative">
    <h2>About this Document</h2>

    <p>
This document is a detailed specification for ...
    </p>

    <ul>
      <li>
Software developers who want to understand the design decisions, data model,
and syntax behind the technology.
      </li>
    </ul>
  </section>
  <section>
    <h3>How this Document is Organized</h3>

    <p>
This document is organized as follows:
    </p>

    <ul>
        <li>
<a href="#terminology">Section 2: Terminology</a> defines basic terminology
used throughout this document.
      </li>
      <li>
<a href="#data-model">Section 3: The Data Model</a> describes the basic data
model used for the technology.
      </li>
      <li>
<a href="#syntax">Section 4: Syntax</a> describes the suggested
expression syntax for the data model.
      </li>
      <li>
<a href="#semantics">Section 5:
Blocks / Ledger Entry Semantics</a> describes how the rules of the ledger
can be set and modified, how content is stored in the ledger, and how
certain parts of the ledger can be optimized.
      </li>
    </ul>
  </section>
</section>

  <section class="normative">
    <h2>Terminology</h2>

    <!--div data-include="//w3c.github.io/webpayments-ig/latest/common/terms.html"
      data-oninclude="restrictReferences">
    </div-->

  </section>

</section>

<section id="data-model">
  <h2>The Data Model</h2>

  <p>
To provide the greatest amount of flexibility, the data model is a graph.
If a formalized data model is desired, RDF may be utilized but is not necessary.
  </p>
</section>

<section id="syntax">
  <h2>The Suggested Syntax</h2>

  <p>
To ensure that the syntax will be easily adopted by developers, and supports
a graph-based data model, it is RECOMMENDED that the implementation syntax is
JSON-LD (or similarly compatible syntax).
Other RDF-compatible syntaxes MAY also be used to express the ledger semantics.
  </p>
</section>

<section id="semantics">
  <h2>Ledger Entry Semantics</h2>

  <p>
A ledger consists of a series of entries. This section outlines the basic
types of entries that all Web Ledgers support. A particular Web Ledger MAY
contain more than these basic entries.
  </p>

  <section id="rules">
    <h2>Setting Operational Rules</h2>

    <p>
Operational rules instruct software algorithms which rules should be applied
when processing a particular Web Ledger. The first entry in a Web Ledger is
typically an operational rule entry.
    </p>

    <pre class="example highlight" title="Example genesis entry for a simple signature-based ledger">
{
  "@context": "https://w3id.org/flex/v1",
  "id": "https://vhda.va.us.gov/ledgers/webville/houses/1",
  "type": "ConfigurationEvent",
  "storageMechanism": "SequentialList",
  "consensusAlgorithm": {
    "type": "ProofOfSignature2016",
    "approvedSigner": "https://webville.va.us.gov/i/planning-department",
    "minimumSignaturesRequired": 1
  },
  "nextEvent": "https://vhda.va.us.gov/ledgers/webville/houses/2",
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2016-02-21T02:10:21Z",
    "creator": "https://webville.va.us.gov/i/planning-department/keys/1",
    "signatureValue": "cNJGLFqT/d/90D4GFzv...yKPiw=="
  }
}
    </pre>

    <pre class="example highlight" title="Example genesis entry for a verifiable claims / credentials ledger">
{
  "@context": "https://w3id.org/flex/v1",
  "id": "https://example.us.gov/ledgers/emergency-response/1",
  "type": "ConfigurationEvent",
  "storageMechanism": "SequentialList",
  "consensusAlgorithm": {
    "type": "ProofOfSignature2016",
    "approvedSigner": [
      "https://fema.example.us.gov/i/ofp",
      "https://tsa.example.us.gov/i/vclaims",
      "https://dhs.example.us.gov/i/credentialing",
    ],
    "minimumSignaturesRequired": 1
  },
  "nextEvent": "https://example.us.gov/ledgers/emergency-response/2",
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2016-09-19T17:19:52Z",
    "creator": "https://fema.example.gov/i/credentialing/keys/7f6",
    "signatureValue": "pjeyuFq9idhwHGfGFzv...9fjsk=="
  }
}
    </pre>

    <pre class="example highlight" title="Example genesis entry for a cryptocurrency ledger">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/cryptocurrencies/v1"
  ],
  "id": "bytecoin:block:23fa73bb201c738d",
  "type": "ConfigurationEvent",
  "storageMechanism": "MerkleTree",
  "consensusAlgorithm": {
    "type": "ProofOfWork2016",
    "proofOfWorkAlgorithm": "Bitcoin",
    "targetDifficulty": "199312067531.243"
  },
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2017-01-24T02:10:21Z",
    "creator": "bytecoin:keys:23f3b2c8183bdd52aff689",
    "signatureValue": "90D4cFqT/yKPiwd/GFzv...NJGL=="
  }
}
    </pre>

    <pre class="example highlight" title="Example genesis entry for a consortium-based debt obligation ledger">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/cryptocurrencies/v1"
  ],
  "id": "https://example-consortium.com/private-ledgers/loans/real-estate/1",
  "type": "ConfigurationEvent",
  "storageMechanism": "SequentialList",
  "consensusAlgorithm": {
    "type": "ProofOfBallot2015",
    "minimumQuorumPercentage": "0.51",
    "minimumVotePercentage": "0.67",
    "approvedSigner": [
      "https://regulator-a.gov/i/bank-oversight",
      "https://regulator-b.gov/i/consumer-protection",
      "https://bank-x.com/i/housing",
      "https://bank-y.com/i/corporate-loans",
      "https://bank-z.com/i/swaps",
    ]
  },
  "signature": [{
    "type": "LinkedDataSignature2016",
    "created": "2018-04-16T19:34:18Z",
    "creator": "https://regulator-b.gov/i/consumer-protection/keys/2f73",
    "signatureValue": "Piw90D4cFqT/yKd/JGLv...NGFz=="
  }, ... // there will be at least 3 more signatures here
  ]
}
    </pre>

  </section>

  <section id="content">
    <h2>Adding Application-specific Data</h2>

    <p>

    </p>

    <pre class="example highlight" title="Example storage event for a real-estate transaction.">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/housing/v1",
  ],
  "id": "https://vhda.va.us.gov/ledgers/webville/houses/2",
  "type": "StorageEvent",
  "previousEvent": "https://example-consortium.com/private-ledgers/loans/real-estate/1",
  "replacesObject": [{
    "id": "https://vhda.va.us.gov/properties/3829344",
    "propertyAddress": {
      "street": "263 Main Street",
      "locality": "Webville",
      "region": "VA",
      "postalCode": "24736-3726",
      "country": "US"
    },
    "owner": {
      "name": "Jane Smith",
      "postalAddress": { ... }
  }],
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2016-02-22T02:10:21Z",
    "creator": "https://webville.va.us.gov/i/planning-department/keys/1",
    "signatureValue": "cNJGLFqT/d/90D4GFzv...yKPiw=="
  }
}
    </pre>

    <pre class="example highlight" title="Example storage event for a verifiable claim transaction">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/dhs/credentials/v1",
  ],
  "id": "https://example.us.gov/ledgers/emergency-response/2",
  "type": "StorageEvent",
  "previousEvent": "https://example.us.gov/ledgers/emergency-response/1",
  "replacesObject": [{
    "id": "https://example.us.gov/credentials/234234542",
    "type": ["Credential", "EmergencyResponseCredential"]
    "claim": {
      "id": "did:3f32-23425-53-241442",
      "emsLicense": {
        "id": "FF-37-48573",
        "status": "valid"
      },
  }],
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2016-09-19T17:19:52Z",
    "creator": "https://fema.example.gov/i/credentialing/keys/7f6",
    "signatureValue": "pjeyuFq9idhwHGfGFzv...9fjsk=="
  }
}
    </pre>

    <pre class="example highlight" title="Example storage event for a crytocurrency state machine">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/cryptocurrencies/v1"
  ],
  "id": "bytecoin:block:83ba663df28372718",
  "type": "StorageEvent",
  "previousEvent": "bytecoin:block:271863df2883ba637",
  "addsObject": [{
    "transaction": [{
      "https://w3id.org/bytecoin/v1"
      "source": "bytecoin:2892316f63778",
      "destination": "bytecoin:983bba526fd6",
      "input": [...], // the inputs to the transaction
      "output": [...], // the outputs from the transaction
      "transfer": {
        "amount": "0.3928621",
        "currency": "bytecoin:currency:bco"
      }
    }], ... // there could be hundreds to thousands more of these
  }]
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2017-01-24T02:11:16Z",
    "creator": "bytecoin:key:23fa73bb201c738d",
    "signatureValue": "90D4cFqT/yKPiwd/GFzv...NJGL=="
  }
}
    </pre>

    <pre class="example highlight" title="Example storage event for a legal entity identifier transaction for the financial industry">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/real-estate/v1"
  ],
  "id": "https://example-consortium.com/private-ledgers/loans/real-estate/2",
  "type": "StorageEvent",
  "previousEvent": "https://example-consortium.com/private-ledgers/loans/real-estate/1",
  "addsObject": [{
    "id": "https://example-consortium.com/private-ledgers/loans/real-estate/transactions/238947234",
    "transaction": {
      "source": "lei:HB7FFAZIO0MZ8PP8OE26", // compliant to ISO 17442 standard
      "destination": "lei:PP8OEHB7FFAZIO0MZ826",
      "transfer": {
        "loanId": "lei:FAZIO0PP8OEHB7FMZ826"
      }
    }
  }],
  "signature": [{
    "type": "LinkedDataSignature2016",
    "created": "2018-04-16T19:34:18Z",
    "creator": "https://regulator-b.gov/i/consumer-protection/keys/2f73",
    "signatureValue": "Piw90D4cFqT/yKd/JGLv...NGFz=="
  }, ... // there will be at least 3 more signatures here
  ]
}
    </pre>

  </section>

  <section id="checkpoints">
    <h2>Checkpointing</h2>

    <p>
A checkpoint log is an entry in the ledger that
    </p>

    <p class="issue">
Don't really know if checkpoints are /that/ useful without
<code>prevId</code> entries. Don't really know if checkpoints
are that useful at all? Seems to be the only use is a link
to a compressed/checksummed file?
    </p>

    <pre class="example highlight" title="Example checkpoint event used to serialize">
{
  "@context": "https://w3id.org/flex/v1",
  "id": "https://example.org/ledgers/example/6372463",
  "type": "CheckpointEvent",
  "checkpointLog": "https://example.org/ledgers/example/checkpoints/132",
  "checkpointLogHash": "urn:sha256:7fa3b9eaa8d92d2b87abf83d88a92ff23",
  "signature": [{
    "type": "LinkedDataSignature2016",
    "created": "2018-04-16T19:34:18Z",
    "creator": "https://example.org/i/master/keys/32",
    "signatureValue": "Piw90D4cFqT/yKd/JGLv...NGFz=="
  }, ... // there may be multiple counter-signatures here
  ]
}
    </pre>
  </section>

  <section id="linking">
    <h2>Linking to Other Ledgers</h2>

    <p class="issue">
    </p>

    <pre class="example highlight" title="Example of a transaction linking to a transaction in another ledger">
{
  "@context": [
    "https://w3id.org/flex/v1",
    "https://w3id.org/cryptocurrencies/v1"
  ],
  "id": "https://example.org/ledgers/example/5",
  "type": "StorageEvent",
  "previousEvent": "https://example.org/ledgers/example/4",
  "addsObject": [{
    "transaction": [{
      "source": "https://example.org/accounts/jane/7",
      "destination": "https://foo.com/accounts/bob/3",
      "remoteLedger": "https://foo.com/ledgers/blah/3445",
      "transfer": {
        "amount": "23.45",
        "currency": "USD"
      }
    }], ... // there could be hundreds to thousands more of these
  }]
  "signature": {
    "type": "LinkedDataSignature2016",
    "created": "2017-01-24T02:11:16Z",
    "creator": "bytecoin:key:23fa73bb201c738d",
    "signatureValue": "90D4cFqT/yKPiwd/GFzv...NJGL=="
  }
}
    </pre>

  </section>

</section>

<section class="appendix informative">
  <h2>Acknowledgements</h2>

  <p>
The editor would like to thank the Web Payments Community Group
  </p>

  <p>
Thanks to the following individuals, in order of their first name, for
their input on the specification: ...
  </p>

</section>

</body>
</html>
